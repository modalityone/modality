<!DOCTYPE html>
<html>
<body style="overflow: hidden;">

<script type="text/javascript"
        src="https://jstest.authorize.net/v3/AcceptUI.js"
        charset="utf-8">
</script>

    <button id="displayFormButton" style="visibility: hidden"
            type="button"
            class="AcceptUI"
            data-billingAddressOptions='{"show":false, "required":false}'
            data-apiLoginID="${apiLoginID}"
            data-clientKey="${clientKey}"
            data-acceptUIFormBtnTxt="Submit your payment"
            data-acceptUIFormHeaderTxt="Please enter your payment information"
            data-responseHandler="responseHandler">
    </button>

<script type="text/javascript">

    // called back by Authorize.net
    function responseHandler(response) {
        let messages = response.messages;
        if (messages.resultCode === "Error") {
            let error = "";
            let message = messages.message;
            for (let i = 0; i < message.length; i++) {
                error += message[i].code + ": " + message[i].text;
            }
            modality_notifyGatewayCardVerificationFailure(error);
        } else {
            // Note: we don't submit the payment form like in Authorize.net example, we call back the Java WebPaymentForm
            // instead that will finish processing the payment via a bus call.
            modality_notifyGatewayPaymentVerificationSuccess(JSON.stringify({
                dataDescriptor: response.opaqueData.dataDescriptor,
                dataValue: response.opaqueData.dataValue
            }));
        }
    }

    // Methods called by WebPaymentForm java class on client-side

    // Parameter injected by WebPaymentForm java class on client-side (to allow JS -> Java callbacks)
    let modality_javaPaymentForm;

    let modality_inited = true;
    let modality_initError;
    let modality_initNotificationCalled;

    function modality_injectJavaPaymentForm(jpf) {
        console.log("modality_injectJavaPaymentForm() called");
        modality_javaPaymentForm = jpf;
        document.getElementById("displayFormButton").click();
        if (modality_inited) {
            if (modality_initError)
                modality_notifyGatewayInitFailure(modality_initError);
            else
                modality_notifyGatewayInitSuccess();
        }
    }

    // Methods called by this JS script to call back the Java WebPaymentForm class

    function modality_notifyGatewayInitSuccess() {
        modality_inited = true;
        if (modality_javaPaymentForm) {
            modality_javaPaymentForm.onGatewayInitSuccess();
            modality_initNotificationCalled = true;
        }
    }

    function modality_notifyGatewayInitFailure(error) {
        modality_inited = true;
        modality_initError = error;
        if (modality_javaPaymentForm) {
            modality_javaPaymentForm.onGatewayInitFailure(error);
            modality_initNotificationCalled = true;
        }
    }

    function modality_notifyGatewayCardVerificationFailure(error) {
        if (modality_javaPaymentForm)
            modality_javaPaymentForm.onGatewayCardVerificationFailure(error);
    }

    function modality_notifyGatewayBuyerVerificationFailure(error) {
        if (modality_javaPaymentForm)
            modality_javaPaymentForm.onGatewayBuyerVerificationFailure(error);
    }

    function modality_notifyGatewayPaymentVerificationSuccess(paymentCompletionPayload) {
        if (modality_javaPaymentForm)
            modality_javaPaymentForm.onGatewayPaymentVerificationSuccess(paymentCompletionPayload);
    }

</script>

</body>
</html>